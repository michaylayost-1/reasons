<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Jorge üíò</title>
  <style>
    :root{
      --bg1:#fff1f6;
      --bg2:#f6f7ff;
      --ink:#1f1f29;
      --muted:#5c5c72;
      --pink:#ff3b8d;
      --rose:#ff5fa0;
      --purple:#7a5cff;
      --card: rgba(255,255,255,.78);
      --border: rgba(31,31,41,.10);
      --shadow: 0 18px 40px rgba(24, 15, 56, .12);
      --shadow2: 0 10px 26px rgba(24, 15, 56, .10);
      --r: 22px;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: var(--sans);
      color: var(--ink);
      background:
        radial-gradient(900px 600px at 20% 10%, rgba(255,59,141,.22), transparent 60%),
        radial-gradient(800px 520px at 80% 0%, rgba(122,92,255,.18), transparent 60%),
        radial-gradient(700px 500px at 60% 90%, rgba(255,95,160,.18), transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      min-height:100vh;
      overflow-x:hidden;
    }

    /* Floating hearts */
    .hearts{ position:fixed; inset:0; pointer-events:none; overflow:hidden; z-index:0; }
    .heart{
      position:absolute; bottom:-40px;
      opacity:.40;
      animation: floatUp linear infinite;
      text-shadow: 0 8px 22px rgba(255,59,141,.25);
      filter: blur(.1px);
    }
    @keyframes floatUp{
      0% { transform: translate(var(--x), 0) rotate(var(--r)); opacity: 0; }
      10%{ opacity:.42; }
      100%{ transform: translate(calc(var(--x) + var(--drift)), -120vh) rotate(calc(var(--r) + 120deg)); opacity: 0; }
    }

    .wrap{ position:relative; z-index:1; max-width: 1020px; margin:0 auto; padding: 28px 18px 70px; }

    .hero{
      background: linear-gradient(135deg, rgba(255,255,255,.84), rgba(255,255,255,.60));
      border: 1px solid rgba(255,255,255,.75);
      border-radius: calc(var(--r) + 12px);
      box-shadow: var(--shadow);
      padding: 22px;
      position:relative;
      overflow:hidden;
    }
    .hero:before{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(320px 200px at 10% 10%, rgba(255,59,141,.18), transparent 70%),
        radial-gradient(360px 220px at 92% 18%, rgba(122,92,255,.16), transparent 70%),
        radial-gradient(320px 220px at 70% 92%, rgba(255,95,160,.14), transparent 70%);
      pointer-events:none;
      filter: blur(1px);
    }
    .hero > *{ position:relative; }

    h1{
      margin:0 0 6px;
      font-size: clamp(28px, 3.5vw, 44px);
      letter-spacing: -0.02em;
      line-height:1.05;
    }
    .name{
      display:flex; align-items:center; gap:10px; flex-wrap:wrap;
      margin: 0 0 10px;
      font-weight: 800;
      color: rgba(255,59,141,.95);
    }
    .badge{
      display:inline-flex; align-items:center; gap:8px;
      padding: 8px 12px; border-radius: 999px;
      background: rgba(255,59,141,.10);
      border: 1px solid rgba(255,59,141,.14);
      color: rgba(255,59,141,.98);
      font-size: 13px;
      user-select:none;
    }
    .sub{
      margin:0;
      color: var(--muted);
      font-size: 15px;
      line-height:1.55;
      max-width: 85ch;
    }

    .topRow{
      margin-top: 14px;
      display:flex; align-items:center; justify-content:space-between;
      gap:12px; flex-wrap:wrap;
    }
    .progressPill{
      display:inline-flex; align-items:center; gap:10px;
      padding: 10px 14px; border-radius: 999px;
      background: rgba(122,92,255,.10);
      border: 1px solid rgba(122,92,255,.14);
      color: var(--muted);
      font-size: 13px;
      user-select:none;
    }
    .progressPill strong{ color: var(--ink); }
    .hint{
      font-size: 12px;
      color: var(--muted);
    }

    .grid{
      display:grid;
      gap: 14px;
      margin-top: 16px;
    }
    @media (min-width: 900px){ .grid{ grid-template-columns: repeat(5, 1fr); } }

    .tileCard{
      background: linear-gradient(180deg, rgba(255,255,255,.86), rgba(255,255,255,.62));
      border: 1px solid rgba(255,255,255,.74);
      border-radius: var(--r);
      box-shadow: var(--shadow2);
      padding: 12px;
      cursor:pointer;
      position:relative;
      overflow:hidden;
      transition: transform .12s ease, filter .2s ease;
      min-height: 190px;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
    }
    .tileCard:hover{ transform: translateY(-2px); filter: brightness(1.02); }
    .tileCard:active{ transform: translateY(0); }
    .tileCard:before{
      content:"";
      position:absolute; inset:-1px;
      background:
        radial-gradient(220px 150px at 18% 5%, rgba(255,59,141,.10), transparent 70%),
        radial-gradient(220px 150px at 105% 40%, rgba(122,92,255,.10), transparent 70%);
      pointer-events:none;
    }
    .tileCard > *{ position:relative; }

    .tileTitle{
      font-weight: 900;
      letter-spacing: -0.01em;
      margin: 6px 0 6px;
      font-size: 14px;
    }
    .tileTag{
      font-size: 12px;
      color: rgba(255,59,141,.95);
      font-weight: 800;
    }
    .miniScene{
      width:100%;
      height: 120px;
      border-radius: 16px;
      border: 1px solid rgba(31,31,41,.08);
      background: rgba(255,255,255,.72);
      overflow:hidden;
      display:grid;
      place-items:center;
    }

    /* Modal */
    .overlay{
      position:fixed; inset:0;
      background: rgba(15, 12, 25, .42);
      display:none;
      z-index: 20;
      padding: 18px;
      overflow:auto;
    }
    .overlay.show{ display:block; }
    .modal{
      max-width: 980px;
      margin: 32px auto;
      background: linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.72));
      border: 1px solid rgba(255,255,255,.78);
      border-radius: calc(var(--r) + 12px);
      box-shadow: var(--shadow);
      position:relative;
      overflow:hidden;
    }
    .modal:before{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(360px 220px at 10% 0%, rgba(255,59,141,.16), transparent 70%),
        radial-gradient(360px 220px at 90% 20%, rgba(122,92,255,.14), transparent 70%);
      pointer-events:none;
      filter: blur(1px);
    }
    .modal > *{ position:relative; }

    .modalTop{
      display:flex; justify-content:space-between; align-items:flex-start;
      gap:12px; flex-wrap:wrap;
      padding: 18px 18px 12px;
    }
    .modalTitle{
      margin:0;
      font-size: 18px;
      letter-spacing:-0.01em;
    }
    .modalSub{
      margin: 4px 0 0;
      color: var(--muted);
      font-size: 13px;
      line-height:1.5;
    }
    .closeBtn{
      appearance:none; border:0;
      background: rgba(255,255,255,.9);
      border: 1px solid rgba(31,31,41,.12);
      color: var(--ink);
      font-weight: 900;
      border-radius: 14px;
      padding: 10px 12px;
      cursor:pointer;
    }
    .closeBtn:hover{ filter: brightness(1.02); }
    .modalBody{
      padding: 0 18px 18px;
      display:grid;
      gap: 14px;
    }

    /* Scene canvas */
    .sceneBox{
      border-radius: 20px;
      border: 1px solid rgba(31,31,41,.10);
      background: rgba(255,255,255,.72);
      box-shadow: var(--shadow2);
      overflow:hidden;
      position:relative;
      height: 360px;
    }
    .sceneLabel{
      position:absolute; left:14px; top:12px;
      font-size: 12px;
      color: rgba(255,59,141,.95);
      font-weight: 900;
      background: rgba(255,59,141,.10);
      border: 1px solid rgba(255,59,141,.14);
      border-radius: 999px;
      padding: 6px 10px;
      user-select:none;
    }

    /* Clickables */
    .clickable{
      position:absolute;
      width: 52px; height: 52px;
      border-radius: 999px;
      border: 2px solid rgba(255,59,141,.65);
      box-shadow: 0 0 0 6px rgba(255,59,141,.10);
      display:grid;
      place-items:center;
      cursor:pointer;
      user-select:none;
      background: rgba(255,255,255,.85);
      transition: transform .12s ease, filter .2s ease;
      animation: pulse 1.8s ease-in-out infinite;
    }
    .clickable:hover{ transform: scale(1.05); filter: brightness(1.02); }
    .clickable.opened{
      animation:none;
      border-color: rgba(20,184,106,.55);
      box-shadow: 0 0 0 6px rgba(20,184,106,.12);
      background: rgba(20,184,106,.10);
    }
    @keyframes pulse{
      0%,100%{ transform: scale(1); }
      50%{ transform: scale(1.05); }
    }
    .icon{ font-size: 22px; }

    /* Pop bubble */
    .bubble{
      position:absolute;
      max-width: min(520px, calc(100% - 26px));
      left: 50%;
      transform: translateX(-50%);
      bottom: 14px;
      background: rgba(255,255,255,.95);
      border: 1px solid rgba(31,31,41,.12);
      border-radius: 18px;
      box-shadow: var(--shadow2);
      padding: 12px 14px;
      display:none;
    }
    .bubble.show{ display:block; }
    .bubble h3{
      margin:0 0 6px;
      font-size: 13px;
      color: rgba(255,59,141,.95);
      letter-spacing:-0.01em;
    }
    .bubble p{
      margin:0;
      font-size: 14px;
      line-height:1.55;
      color: var(--ink);
    }
    .bubble .tiny{
      margin-top: 8px;
      color: var(--muted);
      font-size: 12px;
    }

    /* Tiny heart pop */
    .popHeart{
      position:absolute;
      font-size: 16px;
      opacity: 0;
      animation: pop 700ms ease forwards;
      pointer-events:none;
      filter: drop-shadow(0 10px 16px rgba(255,59,141,.25));
    }
    @keyframes pop{
      0%{ transform: translate(-50%, -50%) scale(.7); opacity:0; }
      20%{ opacity:1; }
      100%{ transform: translate(-50%, -90%) scale(1.15); opacity:0; }
    }

    /* Confetti canvas */
    #confetti{
      position:fixed; inset:0;
      pointer-events:none;
      z-index: 30;
    }

    .finalLine{
      margin-top: 14px;
      display:none;
      background: rgba(255,59,141,.10);
      border: 1px solid rgba(255,59,141,.18);
      border-radius: 18px;
      padding: 12px 14px;
      font-weight: 900;
      color: rgba(255,59,141,.98);
    }
    .finalLine.show{ display:block; }

    .footer{
      margin-top: 18px;
      color: rgba(92,92,114,.9);
      font-size: 12px;
      text-align:center;
      display:flex;
      justify-content:center;
      gap:8px;
      align-items:center;
      flex-wrap:wrap;
    }
  </style>
</head>

<body>
  <div class="hearts" aria-hidden="true" id="hearts"></div>
  <canvas id="confetti" aria-hidden="true"></canvas>

  <div class="wrap">
    <section class="hero">
      <h1>You solved the puzzles!! Happy Valentine‚Äôs Day!! üíò</h1>

      <div class="name">
        <span class="badge">For Jorge ‚ù§Ô∏è</span>
        <span class="badge">From Michayla üíå</span>
      </div>

      <p class="sub">
        Click into each little scene and tap the glowing items to reveal 25 reasons I love you.
        <br><span class="hint">Each reveal will ‚Äúlock in‚Äù green. When you open all 25, there‚Äôs one last message waiting.</span>
      </p>

      <div class="topRow">
        <div class="progressPill">Progress: <strong><span id="progress">0</span>/25</strong> opened</div>
        <div class="progressPill">Tip: everything clickable is outlined in pink ‚ú®</div>
      </div>

      <div class="finalLine" id="finalLine">I love you!! Happy Valentine‚Äôs Day mi amor üíò</div>
    </section>

    <section class="grid" aria-label="Scenes">
      <!-- 1 Pickleball -->
      <div class="tileCard" data-scene="pickle">
        <div>
          <div class="tileTag">Scene 1</div>
          <div class="tileTitle">I‚Äôd be in a real pickle without you ü•í</div>
        </div>
        <div class="miniScene" aria-hidden="true">
          <!-- tiny preview illustration -->
          <svg width="100%" height="100%" viewBox="0 0 220 120">
            <rect x="10" y="14" width="200" height="92" rx="14" fill="rgba(20,184,106,.16)" stroke="rgba(31,31,41,.10)"/>
            <line x1="110" y1="14" x2="110" y2="106" stroke="rgba(255,255,255,.8)" stroke-width="2"/>
            <circle cx="58" cy="44" r="10" fill="rgba(255,59,141,.18)" stroke="rgba(255,59,141,.55)" stroke-width="2"/>
            <circle cx="160" cy="70" r="10" fill="rgba(255,59,141,.12)" stroke="rgba(255,59,141,.55)" stroke-width="2"/>
            <rect x="92" y="70" width="36" height="18" rx="8" fill="rgba(255,255,255,.85)" stroke="rgba(31,31,41,.12)"/>
          </svg>
        </div>
      </div>

      <!-- 2 Piano -->
      <div class="tileCard" data-scene="piano">
        <div>
          <div class="tileTag">Scene 2</div>
          <div class="tileTitle">Your music makes everything softer üéπ</div>
        </div>
        <div class="miniScene" aria-hidden="true">
          <svg width="100%" height="100%" viewBox="0 0 220 120">
            <rect x="18" y="52" width="184" height="44" rx="12" fill="rgba(122,92,255,.14)" stroke="rgba(31,31,41,.10)"/>
            <rect x="30" y="60" width="160" height="28" rx="10" fill="rgba(255,255,255,.85)" stroke="rgba(31,31,41,.12)"/>
            <circle cx="66" cy="36" r="8" fill="rgba(255,59,141,.18)" stroke="rgba(255,59,141,.55)" stroke-width="2"/>
            <circle cx="110" cy="26" r="8" fill="rgba(255,59,141,.12)" stroke="rgba(255,59,141,.55)" stroke-width="2"/>
            <circle cx="154" cy="36" r="8" fill="rgba(255,59,141,.16)" stroke="rgba(255,59,141,.55)" stroke-width="2"/>
          </svg>
        </div>
      </div>

      <!-- 3 Ski -->
      <div class="tileCard" data-scene="ski">
        <div>
          <div class="tileTag">Scene 3</div>
          <div class="tileTitle">You skied straight into my heart ‚õ∑Ô∏è</div>
        </div>
        <div class="miniScene" aria-hidden="true">
          <svg width="100%" height="100%" viewBox="0 0 220 120">
            <path d="M20 98 L85 34 L140 72 L200 26 L200 98 Z" fill="rgba(122,92,255,.10)" stroke="rgba(31,31,41,.10)"/>
            <path d="M20 98 L85 34 L140 72 L200 26" fill="none" stroke="rgba(255,255,255,.85)" stroke-width="3"/>
            <circle cx="72" cy="78" r="9" fill="rgba(255,59,141,.14)" stroke="rgba(255,59,141,.55)" stroke-width="2"/>
            <circle cx="120" cy="56" r="9" fill="rgba(255,59,141,.12)" stroke="rgba(255,59,141,.55)" stroke-width="2"/>
            <circle cx="170" cy="44" r="9" fill="rgba(255,59,141,.16)" stroke="rgba(255,59,141,.55)" stroke-width="2"/>
          </svg>
        </div>
      </div>

      <!-- 4 Flights -->
      <div class="tileCard" data-scene="fly">
        <div>
          <div class="tileTag">Scene 4</div>
          <div class="tileTitle">Our love flies high ‚úàÔ∏è</div>
        </div>
        <div class="miniScene" aria-hidden="true">
          <svg width="100%" height="100%" viewBox="0 0 220 120">
            <rect x="14" y="18" width="192" height="84" rx="16" fill="rgba(59,130,246,.12)" stroke="rgba(31,31,41,.10)"/>
            <path d="M32 82 C60 50, 92 74, 120 44 C148 14, 178 40, 196 26" fill="none" stroke="rgba(255,255,255,.85)" stroke-width="3" stroke-linecap="round"/>
            <circle cx="62" cy="68" r="9" fill="rgba(255,59,141,.14)" stroke="rgba(255,59,141,.55)" stroke-width="2"/>
            <circle cx="128" cy="56" r="9" fill="rgba(255,59,141,.12)" stroke="rgba(255,59,141,.55)" stroke-width="2"/>
            <circle cx="178" cy="34" r="9" fill="rgba(255,59,141,.16)" stroke="rgba(255,59,141,.55)" stroke-width="2"/>
          </svg>
        </div>
      </div>

      <!-- 5 Beach -->
      <div class="tileCard" data-scene="beach">
        <div>
          <div class="tileTag">Scene 5</div>
          <div class="tileTitle">Most amazing day with the most amazing hubby üåÖ</div>
        </div>
        <div class="miniScene" aria-hidden="true">
          <svg width="100%" height="100%" viewBox="0 0 220 120">
            <defs>
              <linearGradient id="sunset" x1="0" x2="0" y1="0" y2="1">
                <stop offset="0" stop-color="rgba(255,95,160,.28)"/>
                <stop offset="1" stop-color="rgba(255,211,77,.18)"/>
              </linearGradient>
            </defs>
            <rect x="14" y="18" width="192" height="84" rx="16" fill="url(#sunset)" stroke="rgba(31,31,41,.10)"/>
            <path d="M22 80 C52 72, 78 86, 110 78 C142 70, 168 88, 198 76" fill="none" stroke="rgba(255,255,255,.85)" stroke-width="3"/>
            <circle cx="72" cy="46" r="9" fill="rgba(255,59,141,.14)" stroke="rgba(255,59,141,.55)" stroke-width="2"/>
            <circle cx="120" cy="54" r="9" fill="rgba(255,59,141,.12)" stroke="rgba(255,59,141,.55)" stroke-width="2"/>
            <circle cx="168" cy="44" r="9" fill="rgba(255,59,141,.16)" stroke="rgba(255,59,141,.55)" stroke-width="2"/>
          </svg>
        </div>
      </div>
    </section>

    <div class="footer">
      <span>Made with love üíò</span><span>‚Ä¢</span><span>Jorge + Michayla ‚ù§Ô∏è</span>
    </div>
  </div>

  <!-- Modal Overlay -->
  <div class="overlay" id="overlay" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal">
      <div class="modalTop">
        <div>
          <h2 class="modalTitle" id="modalTitle">Scene</h2>
          <p class="modalSub" id="modalSub">Tap the glowing items to reveal messages.</p>
        </div>
        <button class="closeBtn" id="closeBtn" type="button">Close ‚úï</button>
      </div>

      <div class="modalBody">
        <div class="sceneBox" id="sceneBox">
          <div class="sceneLabel" id="sceneLabel">Click 5 items</div>

          <!-- clickables injected here -->
          <div class="bubble" id="bubble">
            <h3 id="bubbleTitle">Unlocked üíò</h3>
            <p id="bubbleText"></p>
            <div class="tiny">Keep going ‚Äî you‚Äôre at <strong><span id="bubbleCount">0</span>/25</strong>.</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Floating hearts
    (function makeHearts(){
      const container = document.getElementById("hearts");
      const hearts = ["üíó","üíñ","üíò","üíû","üíï","üíù"];
      for(let i=0;i<18;i++){
        const h = document.createElement("div");
        h.className = "heart";
        h.textContent = hearts[Math.floor(Math.random()*hearts.length)];
        const left = Math.random()*100;
        const dur = 10 + Math.random()*10;
        const delay = Math.random()*6;
        const size = 14 + Math.random()*18;
        const drift = (Math.random()*60 - 30) + "px";
        const x = (Math.random()*40 - 20) + "px";
        const rot = (Math.random()*80 - 40) + "deg";
        h.style.left = left + "vw";
        h.style.fontSize = size + "px";
        h.style.animationDuration = dur + "s";
        h.style.animationDelay = (-delay) + "s";
        h.style.setProperty("--drift", drift);
        h.style.setProperty("--x", x);
        h.style.setProperty("--r", rot);
        container.appendChild(h);
      }
    })();

    // Reasons (25) ‚Äî distributed across scenes (5 each)
    const reasons = [
      "I love that I can always trust you, no matter what.",
      "I love that you put so much thought into the gifts that you give me.",
      "I love your smile and your face when you're laughing.",
      "I love that you are so patient when you teach me how to ski.",
      "I love that you always want to be together.",
      "I love that you taught me how to be more logical and science-based.",
      "I love that you care so much about your health.",
      "I love that you are always so respectful and kind to me.",
      "I love that you love to have adventures and travel together.",
      "I love that you motivate me to be so healthy.",
      "I love that we are working on building an amazing future together.",
      "I love watching you spend time with my family.",
      "I love how you stand up for me in front of others.",
      "I love it when you play the piano so beautifully for me.",
      "I love how athletic you are and that you love to play sports and workout.",
      "I love it when you pull me in for cuddles when I'm sleeping.",
      "I love how you always get me flowers at the airport.",
      "I love your entrepreneurial spirit and how you inspire me with the private practice.",
      "I love the way you smell.",
      "I love how helpful you are and when you carry my heavy bags for me.",
      "I love that you're my best friend.",
      "I love that you put me before anyone else.",
      "I love when you sing me lullabies to sleep.",
      "I love to hear your voice first thing in the morning.",
      "I love that you are perfect for me in every way."
    ];

    // Split into 5 scenes * 5
    const sceneKeys = ["pickle","piano","ski","fly","beach"];
    const scenes = {
      pickle: {
        title: "I‚Äôd be in a real pickle without you ü•í",
        label: "Pickleball Court",
        bg: "pickle",
        icons: ["ü•í","üèì","üü°","üèì","üü°"],
        reasons: reasons.slice(0,5)
      },
      piano: {
        title: "Your music makes everything softer üéπ",
        label: "Piano Notes",
        bg: "piano",
        icons: ["‚ô™","‚ô´","üéº","‚ô™","‚ô´"],
        reasons: reasons.slice(5,10)
      },
      ski: {
        title: "You skied straight into my heart ‚õ∑Ô∏è",
        label: "On the Mountain",
        bg: "ski",
        icons: ["‚ùÑÔ∏è","‚õ∑Ô∏è","‚ùÑÔ∏è","üèîÔ∏è","‚ùÑÔ∏è"],
        reasons: reasons.slice(10,15)
      },
      fly: {
        title: "Our love flies high ‚úàÔ∏è",
        label: "Across the Atlantic",
        bg: "fly",
        icons: ["‚úàÔ∏è","üìç","üó∫Ô∏è","üìç","‚úàÔ∏è"],
        reasons: reasons.slice(15,20)
      },
      beach: {
        title: "Most amazing day with the most amazing hubby üåÖ",
        label: "Beach Sunset",
        bg: "beach",
        icons: ["üïäÔ∏è","üïäÔ∏è","üåä","üïäÔ∏è","üíç"],
        reasons: reasons.slice(20,25)
      }
    };

    // Scene layouts (positions for 5 clickables)
    const layouts = {
      pickle: [
        {x: 18, y: 55}, {x: 38, y: 30}, {x: 56, y: 60}, {x: 74, y: 34}, {x: 86, y: 58}
      ],
      piano: [
        {x: 18, y: 32}, {x: 38, y: 55}, {x: 56, y: 30}, {x: 74, y: 52}, {x: 86, y: 34}
      ],
      ski: [
        {x: 18, y: 58}, {x: 40, y: 40}, {x: 58, y: 56}, {x: 76, y: 36}, {x: 88, y: 54}
      ],
      fly: [
        {x: 16, y: 62}, {x: 36, y: 40}, {x: 56, y: 56}, {x: 76, y: 34}, {x: 88, y: 48}
      ],
      beach: [
        {x: 18, y: 42}, {x: 36, y: 58}, {x: 56, y: 66}, {x: 76, y: 52}, {x: 88, y: 40}
      ]
    };

    // Global opened state
    const opened = new Set(); // id like "pickle-0"
    const progressEl = document.getElementById("progress");
    const finalLine = document.getElementById("finalLine");

    // Modal refs
    const overlay = document.getElementById("overlay");
    const closeBtn = document.getElementById("closeBtn");
    const modalTitle = document.getElementById("modalTitle");
    const modalSub = document.getElementById("modalSub");
    const sceneBox = document.getElementById("sceneBox");
    const sceneLabel = document.getElementById("sceneLabel");
    const bubble = document.getElementById("bubble");
    const bubbleText = document.getElementById("bubbleText");
    const bubbleCount = document.getElementById("bubbleCount");

    // Confetti
    const canvas = document.getElementById("confetti");
    const ctx = canvas.getContext("2d");
    let confetti = [];
    let confettiOn = false;

    function resize(){
      canvas.width = window.innerWidth * devicePixelRatio;
      canvas.height = window.innerHeight * devicePixelRatio;
      ctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);
    }
    window.addEventListener("resize", resize);
    resize();

    function confettiBurst(){
      const count = 230;
      confetti = [];
      for(let i=0;i<count;i++){
        confetti.push({
          x: Math.random()*window.innerWidth,
          y: -20 - Math.random()*window.innerHeight*0.2,
          vx: (Math.random()*2 - 1) * 3,
          vy: 2 + Math.random()*4,
          r: 4 + Math.random()*6,
          a: 0.6 + Math.random()*0.4,
          spin: (Math.random()*2 - 1) * 0.2,
          rot: Math.random()*Math.PI*2,
          life: 220 + Math.random()*120
        });
      }
      confettiOn = true;
      animateConfetti();
    }

    function animateConfetti(){
      if(!confettiOn) return;
      ctx.clearRect(0,0,window.innerWidth,window.innerHeight);

      confetti.forEach(p=>{
        p.x += p.vx; p.y += p.vy; p.rot += p.spin;
        p.vx *= 0.995; p.vy *= 0.99; p.life -= 1;

        ctx.save();
        ctx.globalAlpha = p.a;
        ctx.translate(p.x, p.y);
        ctx.rotate(p.rot);

        // tiny heart confetti
        ctx.beginPath();
        const s = p.r;
        ctx.moveTo(0, s/2);
        ctx.bezierCurveTo(0, 0, -s, 0, -s, s/2);
        ctx.bezierCurveTo(-s, s, 0, s*1.2, 0, s*1.45);
        ctx.bezierCurveTo(0, s*1.2, s, s, s, s/2);
        ctx.bezierCurveTo(s, 0, 0, 0, 0, s/2);

        const t = (p.x + p.y) % 3;
        ctx.fillStyle = t < 1 ? "rgba(255,59,141,.95)" : (t < 2 ? "rgba(255,95,160,.95)" : "rgba(122,92,255,.95)");
        ctx.fill();
        ctx.restore();
      });

      confetti = confetti.filter(p=>p.life > 0 && p.y < window.innerHeight + 40);
      if(confetti.length){ requestAnimationFrame(animateConfetti); }
      else { confettiOn = false; ctx.clearRect(0,0,window.innerWidth,window.innerHeight); }
    }

    function updateProgress(){
      progressEl.textContent = opened.size;
      bubbleCount.textContent = opened.size;
      if(opened.size === 25){
        finalLine.classList.add("show");
        confettiBurst();
      }
    }

    function clearScene(){
      // remove all clickables and pop hearts
      [...sceneBox.querySelectorAll(".clickable,.popHeart")].forEach(el => el.remove());
      bubble.classList.remove("show");
    }

    function setSceneBackground(key){
      // simple cartoony backgrounds via gradients + shapes
      const b = sceneBox;
      b.style.background = "rgba(255,255,255,.72)";
      b.style.position = "relative";

      // remove prior bg svg if exists
      const old = sceneBox.querySelector("svg[data-bg='1']");
      if(old) old.remove();

      const svgNS = "http://www.w3.org/2000/svg";
      const svg = document.createElementNS(svgNS, "svg");
      svg.setAttribute("data-bg","1");
      svg.setAttribute("width","100%");
      svg.setAttribute("height","100%");
      svg.setAttribute("viewBox","0 0 1000 600");
      svg.style.position = "absolute";
      svg.style.inset = "0";
      svg.style.pointerEvents = "none";

      function add(tag, attrs){
        const el = document.createElementNS(svgNS, tag);
        for(const k in attrs) el.setAttribute(k, attrs[k]);
        svg.appendChild(el);
        return el;
      }

      if(key === "pickle"){
        add("rect",{x:"0",y:"0",width:"1000",height:"600",fill:"rgba(20,184,106,.14)"});
        add("rect",{x:"60",y:"70",width:"880",height:"460",rx:"30",fill:"rgba(255,255,255,.60)",stroke:"rgba(31,31,41,.10)"});
        add("line",{x1:"500",y1:"70",x2:"500",y2:"530",stroke:"rgba(255,255,255,.9)","stroke-width":"6"});
        add("rect",{x:"470",y:"250",width:"60",height:"18",rx:"9",fill:"rgba(255,59,141,.22)"});
      } else if(key === "piano"){
        add("rect",{x:"0",y:"0",width:"1000",height:"600",fill:"rgba(122,92,255,.12)"});
        add("rect",{x:"120",y:"320",width:"760",height:"200",rx:"34",fill:"rgba(255,255,255,.62)",stroke:"rgba(31,31,41,.10)"});
        add("rect",{x:"160",y:"350",width:"680",height:"120",rx:"24",fill:"rgba(255,255,255,.78)",stroke:"rgba(31,31,41,.10)"});
        // keys
        for(let i=0;i<10;i++){
          add("rect",{x:String(175+i*66),y:"360",width:"52",height:"100",rx:"10",fill:"rgba(255,255,255,.95)",stroke:"rgba(31,31,41,.08)"});
        }
      } else if(key === "ski"){
        add("rect",{x:"0",y:"0",width:"1000",height:"600",fill:"rgba(122,92,255,.10)"});
        add("path",{d:"M0 520 L260 240 L520 430 L760 220 L1000 360 L1000 600 L0 600 Z",fill:"rgba(255,255,255,.70)"});
        add("path",{d:"M0 520 L260 240 L520 430 L760 220 L1000 360",fill:"none",stroke:"rgba(255,255,255,.95)","stroke-width":"10","stroke-linecap":"round"});
      } else if(key === "fly"){
        add("rect",{x:"0",y:"0",width:"1000",height:"600",fill:"rgba(59,130,246,.12)"});
        add("path",{d:"M80 420 C220 250, 380 460, 520 260 C660 60, 820 240, 920 140",fill:"none",stroke:"rgba(255,255,255,.95)","stroke-width":"10","stroke-linecap":"round"});
        add("circle",{cx:"220",cy:"340",r:"26",fill:"rgba(255,59,141,.18)"});
        add("circle",{cx:"820",cy:"220",r:"26",fill:"rgba(255,59,141,.12)"});
      } else if(key === "beach"){
        // sunset
        const defs = document.createElementNS(svgNS,"defs");
        const lg = document.createElementNS(svgNS,"linearGradient");
        lg.setAttribute("id","sun");
        lg.setAttribute("x1","0"); lg.setAttribute("x2","0"); lg.setAttribute("y1","0"); lg.setAttribute("y2","1");
        const s1 = document.createElementNS(svgNS,"stop"); s1.setAttribute("offset","0"); s1.setAttribute("stop-color","rgba(255,95,160,.30)");
        const s2 = document.createElementNS(svgNS,"stop"); s2.setAttribute("offset","1"); s2.setAttribute("stop-color","rgba(255,211,77,.18)");
        lg.appendChild(s1); lg.appendChild(s2); defs.appendChild(lg); svg.appendChild(defs);
        add("rect",{x:"0",y:"0",width:"1000",height:"600",fill:"url(#sun)"});
        add("rect",{x:"0",y:"360",width:"1000",height:"240",fill:"rgba(59,130,246,.10)"});
        add("path",{d:"M0 410 C160 380, 300 450, 500 410 C700 370, 840 460, 1000 400",fill:"none",stroke:"rgba(255,255,255,.95)","stroke-width":"10"});
      }

      sceneBox.insertBefore(svg, sceneBox.firstChild);
    }

    function openScene(key){
      const scene = scenes[key];
      clearScene();
      setSceneBackground(key);

      modalTitle.textContent = scene.title;
      modalSub.textContent = "Tap the glowing items to reveal messages.";
      sceneLabel.textContent = scene.label;

      // build 5 clickables
      const pos = layouts[key];
      for(let i=0;i<5;i++){
        const id = `${key}-${i}`;
        const btn = document.createElement("div");
        btn.className = "clickable";
        if(opened.has(id)) btn.classList.add("opened");
        btn.style.left = `calc(${pos[i].x}% - 26px)`;
        btn.style.top  = `calc(${pos[i].y}% - 26px)`;
        btn.setAttribute("role","button");
        btn.setAttribute("aria-label","Open message");
        btn.dataset.id = id;
        btn.dataset.text = scene.reasons[i];
        btn.innerHTML = `<div class="icon">${scene.icons[i]}</div>`;
        btn.addEventListener("click", (e)=> reveal(btn, e));
        sceneBox.appendChild(btn);
      }

      overlay.classList.add("show");
      overlay.setAttribute("aria-hidden","false");
    }

    function popHearts(x,y){
      const count = 6;
      for(let i=0;i<count;i++){
        const h = document.createElement("div");
        h.className = "popHeart";
        h.textContent = ["üíò","üíó","üíû","üíï","üíñ"][i % 5];
        h.style.left = x + "px";
        h.style.top  = y + "px";
        h.style.animationDelay = (i*45)+"ms";
        sceneBox.appendChild(h);
        setTimeout(()=>h.remove(), 850);
      }
    }

    function reveal(btn, ev){
      const id = btn.dataset.id;
      const text = btn.dataset.text;

      if(!opened.has(id)){
        opened.add(id);
        btn.classList.add("opened");
        updateProgress();
      }

      // show bubble
      bubbleText.textContent = text;
      bubble.classList.add("show");

      // heart pop at click
      const rect = sceneBox.getBoundingClientRect();
      const x = (ev.clientX - rect.left);
      const y = (ev.clientY - rect.top);
      popHearts(x,y);

      // final confetti when complete
      if(opened.size === 25){
        // confetti already triggered in updateProgress; keep it subtle if reopened
      }
    }

    function closeModal(){
      overlay.classList.remove("show");
      overlay.setAttribute("aria-hidden","true");
      clearScene();
    }

    closeBtn.addEventListener("click", closeModal);
    overlay.addEventListener("click", (e)=>{ if(e.target === overlay) closeModal(); });
    window.addEventListener("keydown", (e)=>{ if(e.key === "Escape") closeModal(); });

    document.querySelectorAll(".tileCard").forEach(card=>{
      card.addEventListener("click", ()=> openScene(card.dataset.scene));
    });

    updateProgress();
  </script>
</body>
</html>
